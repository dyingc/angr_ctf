FROM ubuntu:18.04

ENV DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC

# (Optional but safer for old 18.04 images) switch to old-releases if mirrors 404.
# RUN sed -i 's|archive.ubuntu.com|old-releases.ubuntu.com|g' /etc/apt/sources.list

# Enable i386 and install base tools + Python 3
RUN dpkg --add-architecture i386 \
 && apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates software-properties-common gnupg tzdata \
    make build-essential file binutils \
    python3 python3-pip python3-setuptools python3-wheel \
 # Toolchain PPA (for gcc-9 on 18.04)
 && add-apt-repository -y ppa:ubuntu-toolchain-r/test \
 && apt-get update \
 # GCC 9 + multilib + 32-bit dev/runtime
 && apt-get install -y --no-install-recommends \
    gcc-9 g++-9 \
    gcc-9-multilib g++-9-multilib \
    libc6-dev-i386 libc6:i386 \
 # Python deps
 && pip3 install --no-cache-dir jinja2 \
 # Make gcc-9 the default compiler
 && update-alternatives --install /usr/bin/cc cc /usr/bin/gcc-9 100 \
 && update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 100 \
 && update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 100 \
 # Map "python" and "pip" to Python 3
 && update-alternatives --install /usr/bin/python python /usr/bin/python3 100 \
 && update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 100 \
 && apt-get clean && rm -rf /var/lib/apt/lists/*

WORKDIR /work
CMD ["/bin/bash"]